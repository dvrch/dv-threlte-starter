new architecture

üèóÔ∏è Architecture Hybride : SvelteKit + Django + Stockage Externe
Probl√®me
Limitations Vercel Blob
‚õî Store bloqu√© jusqu'au 01/05/2026 (quotas d√©pass√©s)
üìä Limites Plan Hobby :
Stockage : 1 GB max
Transfert : 10 GB/mois (~333MB/jour)
Lectures : 100k/mois
√âcritures : 10k/mois
Probl√®mes Git
‚ùå 338 MB d'objets dans l'historique Git
üì¶ Fichiers lourds commit√©s :
59M 
static/public/cloth_sim.glb
54M 
static/public/DRAP+Barrel Model1.glb
41M 
static/assets/Desk-bati.glb
32M 
static/models/spaceship.glb
15 autres fichiers .glb/.blend
Architecture actuelle
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  VERCEL (monolithique)                      ‚îÇ
‚îÇ  ‚îú‚îÄ SvelteKit (frontend)                    ‚îÇ
‚îÇ  ‚îú‚îÄ Django (backend) ‚ö†Ô∏è non optimal         ‚îÇ
‚îÇ  ‚îî‚îÄ Vercel Blob ‚ùå bloqu√©                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Proposed Changes
Architecture Cible
üì¶ Stockage - Backblaze B2 / Cloudinary
‚öôÔ∏è Backend - Railway/Render
üåç Frontend - Vercel Free
API Calls
Upload/Download
CDN Direct
SvelteKitSSR + Static
Django APILogique m√©tier
PostgreSQLBase de donn√©es
Fichiers 3D .glbImagesAssets lourds
Composants
1Ô∏è‚É£ Frontend : SvelteKit sur Vercel ‚úÖ GRATUIT
Service : Vercel (plan Hobby) Caract√©ristiques :

D√©ploiement automatique depuis GitHub
SSR + Static Generation
CDN mondial inclus
Limite : 100 GB/mois bande passante
Aucun changement n√©cessaire pour le frontend.

2Ô∏è‚É£ Backend : Django sur Railway/Render
Option A : Railway.app ‚≠ê RECOMMAND√â

Caract√©ristique	Plan Gratuit
Cr√©dits initiaux	$5 gratuit
Dur√©e	Permanent (pay-as-you-go apr√®s)
Services	Django + PostgreSQL + Redis
Co√ªt apr√®s	~$5-10/mois usage mod√©r√©
Configuration Django :

# settings.py - Configuration pour Railway
import os
import dj_database_url
DATABASES = {
    'default': dj_database_url.config(
        conn_max_age=600,
        conn_health_checks=True,
    )
}
# CORS pour SvelteKit
CORS_ALLOWED_ORIGINS = [
    "https://dv-threlte-starter.vercel.app",
    "http://localhost:5173",  # dev
]
Option B : Render.com

Caract√©ristique	Plan Gratuit
Dur√©e	Permanent
Services	Web Service + PostgreSQL
Limite	750h/mois (1 instance)
‚ö†Ô∏è Probl√®me	Pas de stockage persistant fichiers
3Ô∏è‚É£ Stockage : Backblaze B2 vs Cloudinary
Option A : Backblaze B2 üèÜ BEST VALUE

Caract√©ristique	Plan Gratuit
Stockage	10 GB gratuit
Transfert	1 GB/jour gratuit
API	Compatible S3 (boto3)
Co√ªt apr√®s	$0.005/GB/mois stockage
Configuration Django :

# requirements.txt
django-storages[s3]
boto3
# settings.py
DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'
AWS_ACCESS_KEY_ID = os.getenv('B2_KEY_ID')
AWS_SECRET_ACCESS_KEY = os.getenv('B2_APPLICATION_KEY')
AWS_STORAGE_BUCKET_NAME = os.getenv('B2_BUCKET_NAME')
AWS_S3_ENDPOINT_URL = 'https://s3.us-west-004.backblazeb2.com'
AWS_S3_REGION_NAME = 'us-west-004'
AWS_DEFAULT_ACL = 'public-read'
Option B : Cloudinary üé® SIMPLE

Caract√©ristique	Plan Gratuit
Cr√©dits	25/mois
Stockage	25 GB
Transformations	25k/mois
‚ö†Ô∏è Limite	Optimis√© images, pas 3D
Option C : GitHub Pages üÜì ULTRA SIMPLE

Caract√©ristique	Plan Gratuit
Stockage	100 GB*
Bande passante	Illimit√©e*
‚ö†Ô∏è Probl√®me	Fichiers statiques uniquement, pas d'upload dynamique
*Limites soft, OK pour usage raisonnable

Modifications Fichiers
[MODIFY] 
.gitignore
‚úÖ D√©j√† fait - Ignore .glb, .blend, static/assets/, etc.

[MODIFY] 
backend/settings.py
Ajouter configuration Backblaze B2
Configurer CORS pour Vercel
Utiliser variables d'env Railway
[NEW] 
railway.toml
Configuration d√©ploiement Railway pour Django

[MODIFY] 
.env.production
Ajouter URL API Django depuis Railway :

VITE_API_URL=https://dv-threlte-starter-backend.up.railway.app
[NEW] 
scripts/download-vercel-blob.js
Script pour t√©l√©charger tous les fichiers de Vercel Blob

[NEW] 
scripts/upload-to-b2.js
Script pour uploader vers Backblaze B2

Nettoyage Git
Probl√®me : 338 MB d'objets dans l'historique

# Supprimer fichiers lourds de l'historique
pip install git-filter-repo
git filter-repo --path-glob '*.glb' --invert-paths --force
git filter-repo --path-glob '*.blend' --invert-paths --force
git push origin --force --all
User Review Required
WARNING

Choix Architecture √† Valider

L'architecture propos√©e s√©pare compl√®tement Frontend/Backend/Stockage. Cela n√©cessite :

‚ö†Ô∏è R√©√©criture historique Git (git push --force) - action irr√©versible
üí∞ Co√ªt potentiel apr√®s cr√©dits gratuits (~$5-10/mois Railway + Backblaze)
üîß Migration manuelle des fichiers Vercel Blob ‚Üí Backblaze B2
Alternatives :

Attendre le 01/05/2026 (reset quotas Vercel Blob)
Passer √† Vercel Pro ($20/mois)
Utiliser uniquement GitHub Pages pour fichiers statiques (gratuit mais pas d'upload dynamique)
IMPORTANT

D√©cisions Requises

Backend : Railway ($5 cr√©dits) ou Render (100% gratuit mais limit√©) ?
Stockage : Backblaze B2 (10GB gratuit) ou GitHub Pages (simple mais statique) ?
Git : Nettoyer l'historique avec --force maintenant ou garder tel quel ?
Verification Plan
Automated Tests
Tester connexion Django ‚Üí Backblaze B2 :

# Dans le backend Django
python manage.py shell
>>> from django.core.files.storage import default_storage
>>> default_storage.save('test.txt', ContentFile(b'Test'))
>>> print(default_storage.url('test.txt'))
# Devrait afficher URL Backblaze B2
Tester API Django d√©ploy√©e :

curl https://[votre-app].up.railway.app/api/health
# Expected: {"status": "ok"}
Manual Verification
Upload fichier 3D depuis formulaire :

Ouvrir l'app SvelteKit sur Vercel
Remplir formulaire avec fichier .glb
V√©rifier upload vers Backblaze B2
V√©rifier URL retourn√©e accessible publiquement
V√©rifier chargement 3D :

Naviguer vers page affichant mod√®le 3D
Confirmer chargement depuis Backblaze B2 (DevTools ‚Üí Network)
Tester rotation/interaction mod√®le
Tester d√©ploiement Vercel :

npm run build
# V√©rifier taille build/ < 300MB
vercel --prod